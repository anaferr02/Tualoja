<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Publicar alojamiento - TuAloja</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- üîí PROTECCI√ìN: si no est√° logueado, vuelve a login -->
  <script>
    if (localStorage.getItem("tualoja_logged") !== "1") {
      localStorage.setItem("redirect_after_login", "publicar.html");
      location.href = "login.html";
    }
  </script>

  <header class="header">
    <a class="logo" href="index.html">TuAloja.com</a>
    <nav id="mainNav" class="nav">
      <a href="alojamiento.html">Registr√° tu alojamiento</a>
      <a href="ayuda.html">Ayuda</a>
      <span id="navAuth"></span>
    </nav>
    <button id="hamburgerBtn" class="hamburger" type="button">‚ò∞</button>
  </header>

  <main class="contenedor" style="max-width: 980px;">
    <div class="publish-top" style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; margin: 18px 0;">
      <div>
        <h1 style="margin:0;">Publicar alojamiento</h1>
        <p class="muted" style="margin:6px 0 0;">Por ahora sin mapa (gratis). Luego lo sumamos.</p>
      </div>
      <button class="btn btn-outline" type="button" id="btnLogout">Cerrar sesi√≥n</button>
    </div>

    <form id="publishForm" class="card" style="padding:16px;">
      <h2 style="margin-top:0;">Informaci√≥n b√°sica</h2>

      <label>Nombre del alojamiento *</label>
      <input name="titulo" required placeholder="Ej: Caba√±a en el r√≠o" />

      <label>Tipo de alojamiento *</label>
      <select name="tipo" required>
        <option value="">Eleg√≠ una opci√≥n</option>
        <option>Departamento</option>
        <option>Casa</option>
        <option>Caba√±a</option>
        <option>Habitaci√≥n</option>
        <option>Hotel</option>
        <option>Hostel</option>
        <option>Otro</option>
      </select>

      <label>Capacidad (hu√©spedes) *</label>
      <input name="capacidad" type="number" min="1" required placeholder="Ej: 4" />

      <label>Descripci√≥n *</label>
      <textarea name="descripcion" rows="4" required placeholder="Cont√° lo mejor del alojamiento..."></textarea>

      <hr style="margin: 16px 0; opacity:.3;" />

      <h2>Ubicaci√≥n</h2>

      <label>Provincia *</label>
      <input name="provincia" required placeholder="Ej: Entre R√≠os" />

      <label>Ciudad *</label>
      <input name="ciudad" required placeholder="Ej: Villa Elisa" />

      <label>Direcci√≥n aproximada (opcional)</label>
      <input name="direccion" placeholder="Ej: zona centro / a 3 cuadras de..." />

      <label>C√≥digo postal (opcional)</label>
      <input name="cp" placeholder="Ej: 3265" />

      <hr style="margin: 16px 0; opacity:.3;" />

      <h2>Servicios</h2>
      <div class="checks">
        <label><input type="checkbox" name="servicios" value="Wifi" /> Wifi</label>
        <label><input type="checkbox" name="servicios" value="Aire acondicionado" /> Aire acondicionado</label>
        <label><input type="checkbox" name="servicios" value="Calefacci√≥n" /> Calefacci√≥n</label>
        <label><input type="checkbox" name="servicios" value="Cocina" /> Cocina</label>
        <label><input type="checkbox" name="servicios" value="Estacionamiento" /> Estacionamiento</label>
        <label><input type="checkbox" name="servicios" value="Pileta" /> Pileta</label>
        <label><input type="checkbox" name="servicios" value="Parrilla" /> Parrilla</label>
        <label><input type="checkbox" name="servicios" value="Mascotas" /> Acepta mascotas</label>
      </div>

      <hr style="margin: 16px 0; opacity:.3;" />

      <h2>Fotos</h2>
      <p class="muted" style="margin-top:-6px;">Pod√©s subir varias. (MVP: quedan guardadas en el navegador)</p>
      <input id="fotos" type="file" accept="image/*" multiple />
      <div id="preview" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:12px; margin-top:12px;"></div>

      <hr style="margin: 16px 0; opacity:.3;" />

      <h2>Precio</h2>
      <label>Precio por noche (ARS) *</label>
      <input name="precio" type="number" min="0" required placeholder="Ej: 35000" />

      <label>M√≠nimo de noches (opcional)</label>
      <input name="minNoches" type="number" min="1" placeholder="Ej: 2" />

      <hr style="margin: 16px 0; opacity:.3;" />

      <h2>Datos del anfitri√≥n</h2>
      <label>Nombre del anfitri√≥n *</label>
      <input name="anfitrion" required placeholder="Ej: Ana Laura" />

      <label>WhatsApp (opcional)</label>
      <input name="telefono" placeholder="Ej: +54 9 3447..." />

      <label>Email del anfitri√≥n *</label>
      <input name="email" type="email" required placeholder="Ej: contacto@tualoja.com" />

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;">
        <button class="btn" type="submit">Publicar</button>
        <a class="btn btn-outline" href="index.html">Cancelar</a>
      </div>

      <p class="muted" id="msg" style="margin-top:12px;"></p>
    </form>
  </main>

  <footer class="footer-ayuda">
    <p>¬© 2026 TuAloja. Todos los derechos reservados.</p>
    <div class="footer-links">
      <a href="politica-de-privacidad.html">Pol√≠tica de Privacidad</a>
      <span>|</span>
      <a href="terminos-y-condiciones.html">T√©rminos y Condiciones</a>
      <span>|</span>
      <a href="politica-de-cancelacion.html">Pol√≠tica de Cancelaciones</a>
      <span>|</span>
      <a href="politica-anti-estafas.html">Pol√≠tica Anti-Estafas</a>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
    document.getElementById("btnLogout").addEventListener("click", () => {
      localStorage.setItem("tualoja_logged", "0");
      localStorage.removeItem("tualoja_user");
      location.href = "index.html";
    });

    // Fotos preview (simple)
    const fotosInput = document.getElementById("fotos");
    const preview = document.getElementById("preview");
    let fotosBase64 = [];

    fotosInput.addEventListener("change", async () => {
      preview.innerHTML = "";
      fotosBase64 = [];

      const files = Array.from(fotosInput.files || []);
      for (const file of files) {
        const b64 = await fileToBase64(file);
        fotosBase64.push(b64);

        const img = document.createElement("img");
        img.src = b64;
        img.style.width = "100%";
        img.style.height = "110px";
        img.style.objectFit = "cover";
        img.style.borderRadius = "12px";
        preview.appendChild(img);
      }
    });

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(String(reader.result));
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Guardar en localStorage
    document.getElementById("publishForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const f = e.currentTarget;

      const servicios = Array.from(f.querySelectorAll('input[name="servicios"]:checked'))
        .map(i => i.value);

      const data = {
        id: "alo_" + Date.now(),
        titulo: f.titulo.value.trim(),
        tipo: f.tipo.value,
        capacidad: Number(f.capacidad.value),
        descripcion: f.descripcion.value.trim(),
        provincia: f.provincia.value.trim(),
        ciudad: f.ciudad.value.trim(),
        direccion: f.direccion.value.trim(),
        cp: f.cp.value.trim(),
        servicios,
        fotos: fotosBase64,
        precio: Number(f.precio.value),
        minNoches: f.minNoches.value ? Number(f.minNoches.value) : null,
        anfitrion: f.anfitrion.value.trim(),
        telefono: f.telefono.value.trim(),
        email: f.email.value.trim()
      };

      const arr = JSON.parse(localStorage.getItem("tualoja_listings") || "[]");
      arr.unshift(data);
      localStorage.setItem("tualoja_listings", JSON.stringify(arr));

      document.getElementById("msg").textContent = "‚úÖ Publicado (guardado en tu navegador).";
      f.reset();
      preview.innerHTML = "";
      fotosBase64 = [];
    });
  </script>
</body>
</html>
